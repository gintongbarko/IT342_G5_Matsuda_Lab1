flowchart TD
    Start([Open Login Screen/Page]) --> Input[Enter username/email + password]
    Input --> Submit[POST /api/auth/login]
    Submit --> UserFound{User exists?}

    UserFound -->|No| Invalid401[401 Invalid credentials]
    Invalid401 --> Input

    UserFound -->|Yes| ActiveCheck{Account active?}
    ActiveCheck -->|No| Disabled403[403 Account is disabled]
    Disabled403 --> EndFail([Login blocked])

    ActiveCheck -->|Yes| PasswordCheck{Password matches?}
    PasswordCheck -->|No| IncFail[Increment failed_attempts]
    IncFail --> LockCheck{failed_attempts >= 5?}
    LockCheck -->|Yes| Lock[Set user inactive]
    Lock --> Locked403[403 Account locked]
    Locked403 --> EndFail
    LockCheck -->|No| InvalidAgain[401 Invalid credentials]
    InvalidAgain --> Input

    PasswordCheck -->|Yes| ResetState[Reset failed_attempts + update last_login]
    ResetState --> DeactivateSessions[Deactivate prior active sessions]
    DeactivateSessions --> NewSession[Create session + generate JWT]
    NewSession --> Success200[200 AuthResponse(token,user)]
    Success200 --> Store[Store token/user]
    Store --> EndOK([Navigate to dashboard])
