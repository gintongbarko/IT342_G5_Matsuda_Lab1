sequenceDiagram
    participant User as Employee User (Web/Mobile)
    participant UI as Timesheet UI
    participant TSCtrl as TimesheetController
    participant TSSvc as TimesheetService
    participant EmpRepo as EmployeeRepository
    participant TSRepo as TimesheetRecordRepository
    participant DB as MySQL

    User->>UI: Press Clock In
    UI->>TSCtrl: POST /api/timesheets/clock-in (Bearer token)
    TSCtrl->>TSSvc: clockIn(authenticatedUserId)

    TSSvc->>EmpRepo: findTopByEmployeeNameAndCreatedByUser_UserId...
    EmpRepo->>DB: SELECT employee row
    DB-->>EmpRepo: employee

    TSSvc->>TSRepo: findFirstByEmployee_EmployeeIdAndStatus(..., "clocked_in")
    TSRepo->>DB: SELECT active record
    DB-->>TSRepo: record/null

    alt Already clocked in
        TSSvc-->>TSCtrl: RuntimeException("Already clocked in")
        TSCtrl-->>UI: 400 Bad Request
    else No active record
        TSSvc->>TSRepo: save(new TimesheetRecord status=clocked_in)
        TSRepo->>DB: INSERT timesheet_records
        DB-->>TSRepo: saved
        TSSvc-->>TSCtrl: success
        TSCtrl-->>UI: 200 OK
        UI-->>User: Refresh dashboard state
    end
