flowchart TD
    Start([Open Register Screen/Page]) --> Fill[Enter username, email, password, confirm password, role]
    Fill --> RoleCheck{Role selected?}

    RoleCheck -->|Employee| SearchEmp[Search employer via /api/auth/employers/search]
    SearchEmp --> SelectEmp[Select employer username]
    SelectEmp --> ClientValidate
    RoleCheck -->|Employer| ClientValidate[Client validation]

    ClientValidate -->|Invalid| ClientError[Show validation error]
    ClientError --> Fill
    ClientValidate -->|Valid| Submit[POST /api/auth/register]

    Submit --> ServerValidate{Server validation}
    ServerValidate -->|Duplicate user/email| Conflict[409 conflict]
    Conflict --> Fill
    ServerValidate -->|Invalid role/employer| BadRequest[400 bad request]
    BadRequest --> Fill

    ServerValidate -->|Valid| SaveUser[Insert users row]
    SaveUser --> EmpCreate{Role = EMPLOYEE?}
    EmpCreate -->|Yes| SaveEmployee[Insert employees row]
    EmpCreate -->|No| RotateSession
    SaveEmployee --> RotateSession[Deactivate old active sessions]

    RotateSession --> SaveSession[Create new user_sessions row]
    SaveSession --> ReturnAuth[Return 201 + token + user(role, employerName)]
    ReturnAuth --> StoreToken[Store token and user profile]
    StoreToken --> End([Navigate to Timesheet Dashboard])
